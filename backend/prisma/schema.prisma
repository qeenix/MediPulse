// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./clinic.db" // එකම SQLite file එක
}

// 1. Patient ගේ විස්තර
model Patient {
  id              String          @id @default(uuid())
  mobileNumber    String          @unique // ඔයා කිව්ව PK එක
  name            String
  currentWeightKg Float?
  consultations   Consultation[] // Patient ගේ History එක
}

// 2. Doctor ගේ Consultation එක
model Consultation {
  id                   String         @id @default(uuid())
  patient              Patient        @relation(fields: [patientId], references: [id])
  patientId            String
  createdAt            DateTime       @default(now())
  diagnosisNotes       String?        // ලෙඩේ ගැන note එක
  weightAtConsultation Float?         // එදා බලපු weight එක
  attachments          String?       // Save කරපු file වල path (e.g., ["/uploads/patient-123/report.pdf"])
  prescription         Prescription?  // මේ consultation එකට අදාළ prescription එක
}

// 3. බෙහෙත් තුණ්ඩුව
model Prescription {
  id             String            @id @default(uuid())
  consultation   Consultation      @relation(fields: [consultationId], references: [id])
  consultationId String            @unique
  status         PrescriptionStatus @default(PENDING) // PENDING, DISPENSED
  prescribedDrugs PrescribedDrug[] // මේකේ තියෙන බෙහෙත්
  bill           PharmacyBill?
}

enum PrescriptionStatus {
  PENDING
  DISPENSED
  CANCELLED
}

// 4. Pharmacy එකේ තියෙන බෙහෙත් වර්ග
model Drug {
  id           String         @id @default(uuid())
  name         String         @unique // e.g., "Paracetamol"
  category     DrugCategory   // ඔයා කිව්ව category ටික
  unit         String         // e.g., "mg", "ml"
  stockItems   StockItem[]
  prescribedIn PrescribedDrug[]
}

// ඔයා ඉල්ලපු බෙහෙත් Categories
enum DrugCategory {
  TABLET
  CAPSULE
  SYRUP_LIQUID
  INJECTION
  CREAM_OINTMENT_GEL
  DROPS
  INHALER
  SUPPOSITORY
  POWDER
}

// 5. Stock එක (Batch, Expiry එක්ක)
model StockItem {
  id              String     @id @default(uuid())
  drug            Drug       @relation(fields: [drugId], references: [id])
  drugId          String
  batchNumber     String?
  expiryDate      DateTime
  quantityInStock Int
  purchasePrice   Float
  sellingPrice    Float
  supplier        Supplier?  @relation(fields: [supplierId], references: [id])
  supplierId      String?
}

// 6. Prescription එකේ තියෙන එක බෙහෙතක්
model PrescribedDrug {
  id             String       @id @default(uuid())
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])
  prescriptionId String
  drug           Drug         @relation(fields: [drugId], references: [id])
  drugId         String
  dosage         String       // e.g., "500mg, 1x3"
  quantity       Int          // පෙති කීයක් ද?
}

// 7. Suppliers ලගේ විස්තර
model Supplier {
  id          String      @id @default(uuid())
  name        String      @unique
  contactInfo String?
  stockItems  StockItem[]
}

// 8. Pharmacy එකේ Bill එක
model PharmacyBill {
  id             String       @id @default(uuid())
  prescription   Prescription @relation(fields: [prescriptionId], references: [id])
  prescriptionId String       @unique
  totalAmount    Float
  issuedAt       DateTime     @default(now())
}